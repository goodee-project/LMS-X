<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="gd.fintech.lms.teacher.mapper.TeacherLectureStudentMapper">
	
	<resultMap type="gd.fintech.lms.vo.LectureAndStudentAndClassRegistrationAndTeacher" id="selectTeacherStudentListResult">
		<collection property="student" ofType="gd.fintech.lms.vo.Student">
			<result property="studentId" column="student_id" />
			<result property="studentName" column="student_name" />
			<result property="studentGender" column="student_gender" />
			<result property="studentPhone" column="student_phone" />
			<result property="studentAddressMain" column="student_address_main" />
		</collection>
		<!-- 강좌 수강 -->
		<collection property="classRegistration" ofType="gd.fintech.lms.vo.ClassRegistration">
			<result property="accountId" column="account_id" />
			<result property="lectureNo" column="lecture_no" />
		</collection>
		
		<!-- 강좌 -->
		<collection property="lecture" ofType="gd.fintech.lms.vo.Lecture">
			<result property="lectureNo" column="lecture_no" />
		</collection>
		
		<!-- 강사 -->
		<collection property="teacher" ofType="gd.fintech.lms.vo.Teacher">
			<result property="teacherName" column="teacher_name" />
		</collection>
	</resultMap>
	<!-- 강의를 듣는 학생 목록을 출력 -->
	<select id="selectTeacherLectureStudentListByPage" parameterType="java.util.Map" resultMap="selectTeacherStudentListResult">
		SELECT
			l.lecture_no,
			cr.account_id,
			s.student_id,
			s.student_name,
			s.student_gender,
			s.student_phone,
			s.student_address_main
		FROM
			lecture l
		LEFT OUTER JOIN class_registration cr
			ON l.lecture_no = cr.lecture_no
		LEFT OUTER JOIN student s
			ON s.student_id = cr.account_id
		LEFT OUTER JOIN teacher t
			ON t.teacher_name = l.teacher_name
		WHERE 
			t.teacher_name = #{teacherName}
		ORDER BY
		 	s.student_id DESC
		 LIMIT
		 	#{beginRow}, #{rowPerPage}
	</select>
	
	<!-- 강의를 듣는 학생 수 -->
	<select id="selectTeacherLectureStudentCount" parameterType="String" resultType="int">
		SELECT
			COUNT(*)
		FROM
			lecture l
		LEFT OUTER JOIN class_registration cr
			ON l.lecture_no = cr.lecture_no
		LEFT OUTER JOIN student s
			ON s.student_id = cr.account_id
		LEFT OUTER JOIN teacher t
			ON t.teacher_name = l.teacher_name
		WHERE
			t.teacher_name = #{teacherName} AND l.lecture_no = #{lectureNo}
	</select>
</mapper>

